(window["webpackJsonpreact-shogi-board"]=window["webpackJsonpreact-shogi-board"]||[]).push([[0],{37:function(e,t,n){e.exports=n(69)},69:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(30),i=n(10),c=n.n(i),s=n(12),u=n(5),l=n(6),f=n(8),d=n(7),h=n(9),v=n(31),p=n(14),m=n.n(p),b=n(32),g=n.n(b),k=n(18),y=n(4),x=n.n(y),O=n(1),j=n(2);function w(){var e=Object(O.a)(["\n  width: 360px;\n  height: 360px;\n  margin: 0 auto;\n  color: #fff;\n  border-bottom: 1px solid ",";\n  border-left: 1px solid ",";\n  display: grid;\n  grid-template: repeat(9, 1fr) / repeat(9, 1fr);\n"]);return w=function(){return e},e}var B=j.b.div(w(),"#666","#666");function E(){var e=Object(O.a)(["\n    background: #ddd;\n    animation: "," 1.5s ease-in 1 normal;\n  "]);return E=function(){return e},e}function C(){var e=Object(O.a)(["\n    background: white;\n  "]);return C=function(){return e},e}function S(){var e=Object(O.a)(["\n  background-color: #eee;\n  border-top: 1px solid ",";\n  border-right: 1px solid ",";\n  font-family: Helvetica;\n  font-weight: bold;\n  font-size: 1em;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  ","\n  ","\n\n"]);return S=function(){return e},e}function P(){var e=Object(O.a)(["\n  0% {opacity: 0.8}\n  100% {opacity: 1;}\n"]);return P=function(){return e},e}var H=Object(j.c)(P()),I=j.b.div(S(),"#666","#666",function(e){return e.overlay&&Object(j.a)(C())},function(e){return e.strong&&Object(j.a)(E(),H)});function M(){var e=Object(O.a)(["\n    animation: "," 1.5s ease-in-out infinite alternate;\n  "]);return M=function(){return e},e}function K(){var e=Object(O.a)(["\n  color: #222;\n  font-size: 1.4em;\n  cursor: pointer;\n\n  ","\n"]);return K=function(){return e},e}function N(){var e=Object(O.a)(["\n  0% {opacity: 1}\n  100% {opacity: 0.6;}\n"]);return N=function(){return e},e}function W(){var e=Object(O.a)(["\n    transform: scale(1,-1);\n  "]);return W=function(){return e},e}function L(){var e=Object(O.a)(["\n  ","\n"]);return L=function(){return e},e}var T=0,A=1,G=j.b.div(L(),function(e){return e.upSideDown&&Object(j.a)(W())}),Y=Object(j.c)(N()),D=j.b.span(K(),function(e){return e.blink&&Object(j.a)(M(),Y)});var F=function(e){function t(){return Object(u.a)(this,t),Object(f.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.color,n=e.kind,r=e.blink,a=e.reversed?t===T:t===A;return o.a.createElement(G,{upSideDown:a},o.a.createElement(D,{blink:r},function(e){switch(e){case"FU":return"\u6b69";case"KY":return"\u9999";case"KE":return"\u6842";case"GI":return"\u9280";case"KI":return"\u91d1";case"TO":return"\u3068";case"NY":return"\u674f";case"NK":return"\u572d";case"NG":return"\u5168";case"KA":return"\u89d2";case"HI":return"\u98db";case"OU":return"\u7389";case"UM":return"\u99ac";case"RY":return"\u9f8d";default:return""}}(n)))}}]),t}(r.Component);function R(){var e=Object(O.a)(["\n  cursor: pointer;\n  font-size: 0.8em;\n  margin: 0.25em;\n  padding: 0.25em 0.5em;\n"]);return R=function(){return e},e}function U(){var e=Object(O.a)(["\n  height: 1em;\n  margin: 0;\n  padding: 15px 0;\n"]);return U=function(){return e},e}var z=j.b.div(U()),X=j.b.span(R());function J(e){switch(e){case"FU":return"\u6b69";case"KY":return"\u9999";case"KE":return"\u6842";case"GI":return"\u9280";case"KI":return"\u91d1";case"KA":return"\u89d2";case"HI":return"\u98db";default:return null}}var _=function(e){function t(){return Object(u.a)(this,t),Object(f.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.kind,n=e.count,r=e.onClick;return o.a.createElement(X,{onClick:r},"".concat(J(t)," ").concat(n))}}]),t}(r.Component),q=n(11);function Q(e,t,n){return x.a.find(e.movableBoxes,{x:t,y:n})}function $(e,t,n){return x.a.find(e.droppableBoxes,{x:t,y:n})}function V(e,t){return e===q.Color.Black?t<=3:t>=7}function Z(e,t,n,r){return!!function(e){return q.Piece.canPromote(e)}(e)&&!(!V(t,n)&&!V(t,r))}var ee=n(11),te=ee.Shogi,ne=ee.Color,re=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).state={shogi:{},board:[],hands:[],selectedBox:{},selectedHand:{},lastMovedBox:{},movableBoxes:[],droppableBoxes:[],moveCount:1,turn:0,sfen:"",histories:[],reversed:!1},n.emitter=e.emitter,n.emitter.on("ai",function(e){var t=e.bestmove,r=e.bestpv;if(console.log("fire ai",t,r),t.match(/\*/)){var o=function(e){var t=e.split("");return{kind:{P:"FU",L:"KY",N:"KE",S:"GI",G:"KI",B:"KA",R:"HI"}[t[0]],x:parseInt(t[2],10),y:{a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9}[t[3]]}}(t),a=o.x,i=o.y,c=o.kind;return n.state.shogi.drop(a,i,c),n.setState({lastMovedBox:{x:a,y:i}}),void n.finishTurn()}var s=function(e){var t=e.split(""),n={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9};return{fromX:parseInt(t[0],10),fromY:n[t[1]],toX:parseInt(t[2],10),toY:n[t[3]],promote:!!t[4]}}(t),u=s.fromX,l=s.fromY,f=s.toX,d=s.toY,h=s.promote;n.state.shogi.move(u,l,f,d,h),n.setState({lastMovedBox:{x:f,y:d}}),n.finishTurn()}),n.emitter.on("wait",function(e){console.log("fire wait");var t=n.state,r=t.shogi,o=t.moveCount,a=t.histories,i=a.length;if(!(i<2)){var c=a[i-3];n.state.shogi.initializeFromSFENString(c),n.state.shogi.turn=0,n.setState({board:r.board,hands:r.hands,lastMovedBox:{},selectedBox:{},movableBoxes:[],droppableBoxes:[],turn:0,moveCount:o-2,histories:Object.assign([],Object(k.a)(a.slice(i-2))),sfen:c,reversed:!1})}}),n.emitter.on("reverse",function(e){console.log("fire reverse");var t=n.state.reversed;n.setState({reversed:!t})}),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(e){var t=new te;this.setState({shogi:t,board:Object.assign([],t.board),hands:Object.assign([],t.hands),selectedBox:{},movableBoxes:[],moveCount:1,turn:0,sfen:"lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL w - 1",histories:["lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL w - 1"]})}},{key:"getCurrentSfen",value:function(){return this.state.shogi.toSFENString(this.state.moveCount)}},{key:"select",value:function(e,t){var n=this.state.shogi.get(e,t);if(n&&this.state.shogi.turn===n.color){var r=this.state.shogi.getMovesFrom(e,t);this.setState({selectedBox:{x:e,y:t},movableBoxes:r.map(function(e){return e.to}),droppableBoxes:[]})}}},{key:"selectHand",value:function(e,t){var n=this.state.shogi;n.turn===e&&this.setState({selectedHand:{kind:t},movableBoxes:[],droppableBoxes:n.getDropsBy(e).map(function(e){return e.to})})}},{key:"move",value:function(e,t){var n=this.state,r=n.shogi,o=n.board,a=n.selectedBox,i=r.get(a.x,a.y),c=x.a.cloneDeep(o);if(c[a.x-1][a.y-1]=void 0,c[e-1][t-1]=i,function(e,t){var n=function(e,t){var n=[1,2,3,4,5,6,7,8,9],r={};return n.forEach(function(o){n.forEach(function(n){var a=t[n-1][o-1]||{};a.color===e&&"OU"===a.kind&&(r={x:n,y:o})})}),r}(e,t),r=function(e,t){var n=[],r=[1,2,3,4,5,6,7,8,9];return r.forEach(function(o){r.forEach(function(r){(t[r-1][o-1]||{}).color===e&&n.push({x:r,y:o})})}),n}(0===e?1:0,t),o=new q.Shogi;o.board=Object.assign([],t);for(var a=0;a<r.length;a++){var i=r[a],c=i.x,s=i.y,u=o.getMovesFrom(c,s);if(x.a.find(u,function(e){var t=e.to;return t.x===n.x&&t.y===n.y}))return!0}return!1}(r.turn,c))window.alert("\u738b\u624b\u3067\u3059");else{var s=!1;Z(i.kind,i.color,a.y,t)&&(s=window.confirm("\u6210\u308a\u307e\u3059\u304b?")),r.move(a.x,a.y,e,t,s),this.finishTurn()}}},{key:"drop",value:function(e,t){var n=this.state,r=n.shogi,o=n.selectedHand;r.drop(e,t,o.kind),this.finishTurn()}},{key:"finishTurn",value:function(){var e=this.state,t=e.shogi,n=e.moveCount,r=e.histories,o=this.getCurrentSfen();this.setState({board:x.a.cloneDeep(t.board),hands:x.a.cloneDeep(t.hands),selectedBox:{},movableBoxes:[],droppableBoxes:[],turn:t.turn,moveCount:n+1,histories:Object.assign([],[].concat(Object(k.a)(r),[o])),sfen:o}),this.emitter.emit("finishTurn",t.turn)}},{key:"reset",value:function(){this.setState({selectedBox:{},selectedHand:{},movableBoxes:[],droppableBoxes:[]})}},{key:"isLastMovedBox",value:function(e,t){return this.state.lastMovedBox.x===e&&this.state.lastMovedBox.y===t}},{key:"handleClickBox",value:function(e,t){x.a.isEmpty(this.state.selectedHand)||!$(this.state,e,t)?x.a.isEmpty(this.state.selectedBox)?this.select(e,t):Q(this.state,e,t)?this.move(e,t):this.reset():this.drop(e,t)}},{key:"handleClickHand",value:function(e,t){x.a.isEmpty(this.state.selectedHand)&&this.selectHand(e,t)}},{key:"render",value:function(){var e=this,t=this.state,n=t.shogi,r=t.board,a=(t.reversed,function(e){return x.a.isEmpty(n)?{}:n.getHandsSummary(e)}),i=this.state.reversed,c=[1,2,3,4,5,6,7,8,9],s=[9,8,7,6,5,4,3,2,1],u=i?c:s,l=i?s:c,f=[];r.length>0&&l.forEach(function(e){u.forEach(function(t){var n=r[t-1][e-1]||{};f.push({piece:n,x:t,y:e})})});var d=a(i?ne.Black:ne.White),h=a(i?ne.White:ne.Black);return o.a.createElement("div",{style:{margin:"0 auto",maxWidth:"360px"}},o.a.createElement(z,null,Object.keys(d).filter(function(e){return d[e]>0}).map(function(t){return o.a.createElement(_,{onClick:function(){return e.handleClickHand(ne.White,t)},key:t,kind:t,count:d[t]})})),o.a.createElement(B,null,f.map(function(t){var n=t.piece,r=t.x,a=t.y;return o.a.createElement(I,{key:r+"-"+a,overlay:Q(e.state,r,a)||$(e.state,r,a),strong:!Q(e.state,r,a)&&e.isLastMovedBox(r,a),onClick:function(){return e.handleClickBox(r,a)}},n&&o.a.createElement(F,{reversed:i,color:n.color,kind:n.kind,blink:e.isLastMovedBox(r,a)}))})),o.a.createElement(z,null,Object.keys(h).filter(function(e){return h[e]>0}).map(function(t){return o.a.createElement(_,{onClick:function(){return e.handleClickHand(ne.Black,t)},key:t,kind:t,count:h[t]})})))}}]),t}(r.Component),oe="https://t3ayycpoqg.execute-api.ap-northeast-1.amazonaws.com/dev/";function ae(e){var t=g.a.stringify({byoyomi:1,sfen:"sfen ".concat(e)});return m.a.get("".concat(oe,"/api/gikou?").concat(t)).catch(console.error)}var ie=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).state={nextMove:"",pv:{}},n.emitter=new v.EventEmitter,n.emitter.on("finishTurn",function(e){1===e&&n.handleClickAI()}),m.a.get("".concat(oe,"/api/setup")).catch(console.error),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.setState({nextMove:e.target.value})}},{key:"handleClick",value:function(e){this.emitter.emit("moveNext",this.state.nextMove),e.preventDefault()}},{key:"handleClickAI",value:function(){var e=Object(s.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae(this.game.getCurrentSfen());case 2:t=e.sent,console.log(t.data),this.setState({pv:t.data.bestpv}),this.emitter.emit("ai",t.data);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleClickWait",value:function(){var e=Object(s.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emitter.emit("wait");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleClickReverse",value:function(){var e=Object(s.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emitter.emit("reverse");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.pv,n="\u4e92\u89d2";return t.score_cp<-500?n="\u512a\u52e2":t.score_cp>500&&(n="\u52a3\u52e2"),o.a.createElement("div",null,o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement("h1",{style:{fontSize:"1em"}},"\u6280\u5de7v2.0.2")),o.a.createElement(re,{emitter:this.emitter,observable:this.observable,ref:function(t){e.game=t}}),o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement("div",null,o.a.createElement("button",{onClick:this.handleClickWait.bind(this)},"Wait")," ",o.a.createElement("button",{onClick:this.handleClickAI.bind(this)},"Hint")," ",o.a.createElement("button",{onClick:this.handleClickReverse.bind(this)},"Reverse")),o.a.createElement("p",null,"\u6226\u6cc1: ",-1*(t.score_cp||0)," ",n),o.a.createElement("p",null,JSON.stringify(t))))}}]),t}(r.Component),ce=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function se(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}Object(a.render)(o.a.createElement(ie,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/react-shogi-board",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/react-shogi-board","/service-worker.js");ce?(!function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):se(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):se(e)})}}()}},[[37,1,2]]]);
//# sourceMappingURL=main.a74850bc.chunk.js.map